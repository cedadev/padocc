<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CCI Water Vapour Example &mdash; Padocc Package v1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=3dd8cc91"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pipeline Flags" href="execution.html" />
    <link rel="prev" title="Getting Started" href="start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Padocc Package
              <img src="_static/ceda.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pipeline-overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example CCI Water Vapour</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution.html">Padocc Flags/Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="assess-overview.html">Assessor Tool Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error Codes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Padocc Package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CCI Water Vapour Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cci_water.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cci-water-vapour-example">
<h1>CCI Water Vapour Example<a class="headerlink" href="#cci-water-vapour-example" title="Permalink to this heading"></a></h1>
<p>The CCI water vapour input CSV file can be found in <code class="docutils literal notranslate"><span class="pre">extensions/example_water_vapour/</span></code> within this repository. This guide will take you through running the pipeline for this example set of 4 datasets.
Assuming you have already gone through the setup instructions in <em>Getting Started</em>, you can now proceed with creating a group for this test dataset.</p>
<p>A new <em>group</em> is created within the pipeline using the <code class="docutils literal notranslate"><span class="pre">init</span></code> operation as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">group_run</span><span class="o">.</span><span class="n">py</span> <span class="n">init</span> <span class="o">&lt;</span><span class="n">my_new_group</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">i</span> <span class="n">extensions</span><span class="o">/</span><span class="n">example_water_vapour</span><span class="o">/</span><span class="n">water_vapour</span><span class="o">.</span><span class="n">csv</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multiple flag options are available throughout the pipeline for more specific operations and methods. In the above case we have used the (-v) <em>verbose</em> flag to indicate we want to see the <code class="docutils literal notranslate"><span class="pre">[INFO]</span></code> messages put out by the pipeline. Adding a second (v) would also show <code class="docutils literal notranslate"><span class="pre">[DEBUG]</span></code> messages.
Also the <code class="docutils literal notranslate"><span class="pre">init</span></code> phase is always run as a serial process since it just involves creating the directories and config files required by the pipeline.</p>
</div>
<p>The output of the above command should look something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">INFO [main-group]: Running init steps as serial process</span>
<span class="go">INFO [init]: Starting initialisation</span>
<span class="go">INFO [init]: Copying input file from relative path - resolved to /home/users/dwest77/Documents/kerchunk_dev/kerchunk-builder</span>
<span class="go">INFO [init]: Creating project directories</span>
<span class="go">INFO [init]: Creating directories/filelists for 1/4</span>
<span class="go">INFO [init]: Updated new status: init - complete</span>
<span class="go">INFO [init]: Creating directories/filelists for 2/4</span>
<span class="go">INFO [init]: Updated new status: init - complete</span>
<span class="go">INFO [init]: Creating directories/filelists for 3/4</span>
<span class="go">INFO [init]: Updated new status: init - complete</span>
<span class="go">INFO [init]: Creating directories/filelists for 4/4</span>
<span class="go">INFO [init]: Updated new status: init - complete</span>
<span class="go">INFO [init]: Created 24 files, 8 directories in group my_new_group</span>
<span class="go">INFO [init]: Written as group ID: my_new_group</span>
</pre></div>
</div>
<p>Ok great, we’ve initialised the pipeline for our new group! Here’s a summary diagram of what directories and files were just created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WORKDIR</span>
  <span class="o">-</span> <span class="n">groups</span>
     <span class="o">-</span>  <span class="n">my_new_group</span>
         <span class="o">-</span>  <span class="n">proj_codes</span>
             <span class="o">-</span>  <span class="n">main</span><span class="o">.</span><span class="n">txt</span>
         <span class="o">-</span>  <span class="n">blacklist_codes</span><span class="o">.</span><span class="n">txt</span>
         <span class="o">-</span>  <span class="n">datasets</span><span class="o">.</span><span class="n">csv</span> <span class="c1"># (a copy of the input file)</span>

  <span class="o">-</span> <span class="n">in_progress</span>
     <span class="o">-</span>  <span class="n">my_new_group</span>
         <span class="o">-</span>  <span class="n">code_1</span> <span class="c1"># (codes 1 to 4 in this example)</span>
             <span class="o">-</span>  <span class="n">allfiles</span><span class="o">.</span><span class="n">txt</span>
             <span class="o">-</span>  <span class="n">base</span><span class="o">-</span><span class="n">cfg</span><span class="o">.</span><span class="n">json</span>
             <span class="o">-</span>  <span class="n">phase_logs</span>
                 <span class="o">-</span>  <span class="n">scan</span><span class="o">.</span><span class="n">log</span>
                 <span class="o">-</span>  <span class="n">compute</span><span class="o">.</span><span class="n">log</span>
                 <span class="o">-</span>  <span class="n">validate</span><span class="o">.</span><span class="n">log</span>
             <span class="o">-</span>  <span class="n">status_log</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>For peace of mind and to check you understand the pipeline assessor tool we would suggest running this command next:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">assess</span><span class="o">.</span><span class="n">py</span> <span class="n">progress</span> <span class="n">my_new_group</span>
</pre></div>
</div>
<p>Upon which your output should look something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Group: my_new_group</span>
<span class="go">Total Codes: 4</span>

<span class="go">Pipeline Current:</span>

<span class="go">init      : 4     [100.%] (Variety: 1)</span>
<span class="go">    - complete : 4</span>

<span class="go">Pipeline Complete:</span>

<span class="go">complete  : 0     [0.0 %]</span>
</pre></div>
</div>
<p>All 4 of our datasets were initialised successfully, no datasets are complete through the pipeline yet.</p>
<p>The next steps are to <code class="docutils literal notranslate"><span class="pre">scan</span></code>, <code class="docutils literal notranslate"><span class="pre">compute</span></code>, and <code class="docutils literal notranslate"><span class="pre">validate</span></code> the datasets which would complete the pipeline.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For each of the above phases, jobs will be submitted to SLURM when using the <code class="docutils literal notranslate"><span class="pre">group_run</span></code> script. Please make sure to wait until all jobs are complete for one phase <em>before</em> running the next job.
After each job, check the progress of the pipeline with the same command as before to check all the datasets <code class="docutils literal notranslate"><span class="pre">complete</span></code> as expected. See below on what to do if datasets encounter errors.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python group_run.py scan my_new_group</span>
<span class="go">python group_run.py compute my_new_group</span>
<span class="go">python group_run.py validate my_new_group</span>
</pre></div>
</div>
<p>An more complex example of what you might see while running the pipeline in terms of errors encountered can be found below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Group: cci_group_v1</span>
<span class="go">Total Codes: 361</span>

<span class="go">Pipeline Current:</span>

<span class="go">compute   : 21    [5.8 %] (Variety: 2)</span>
<span class="go">    - complete                 : 20</span>
<span class="go">    - KeyError &#39;refs&#39;          : 1</span>

<span class="go">Pipeline Complete:</span>

<span class="go">complete  : 185   [51.2%]</span>

<span class="go">blacklist : 155   [42.9%] (Variety: 8)</span>
<span class="go">    - NonKerchunkable          : 50</span>
<span class="go">    - PartialDriver            : 3</span>
<span class="go">    - PartialDriverFail        : 5</span>
<span class="go">    - ExhaustedMemoryLimit     : 56</span>
<span class="go">    - ExhaustedTimeLimit       : 18</span>
<span class="go">    - ExhaustedTimeLimit*      : 1</span>
<span class="go">    - ValidationMemoryLimit    : 21</span>
<span class="go">    - ScipyDimIssue            : 1</span>
</pre></div>
</div>
<p>In this example <code class="docutils literal notranslate"><span class="pre">cci_group_v1</span></code> group, 185 of the datasets have completed the pipeline, while 155 have been excluded (See blacklisting in the Assessor Tool section).
Of the remaining 21 datasets, 20 of them have completed the <code class="docutils literal notranslate"><span class="pre">compute</span></code> phase and now need to be run through <code class="docutils literal notranslate"><span class="pre">validate</span></code>, but one encountered a KeyError which needs to be inspected. To view the log for this dataset we can use the command below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python assess.py progress cci_group_v1 -e &quot;KeyError &#39;refs&#39;&quot; -p compute -E</span>
</pre></div>
</div>
<p>This will match with our <code class="docutils literal notranslate"><span class="pre">compute</span></code>-phase error with that message, and the (-E) flag will give us the whole error log from that run. This may be enough to assess and fix the issue but otherwise, to rerun just this dataset a rerun command will be suggested by the assessor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Project Code: 201601-201612-ESACCI-L4_FIRE-BA-MSI-fv1.1 - &lt;class &#39;KeyError&#39;&gt;&#39;refs&#39;</span>
<span class="go">Rerun suggested command:    python single_run.py compute 218 -G cci_group_v1 -vv -d</span>
</pre></div>
</div>
<p>This rerun command has several flags included, the most importand here is the (-G) group flag, since we need to use the <code class="docutils literal notranslate"><span class="pre">single_run</span></code> script so now need to specify the group. The (-d) dryrun flag will simply mean we are not producing any output files since we may need to test and rerun several times.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="start.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="execution.html" class="btn btn-neutral float-right" title="Pipeline Flags" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Daniel Westwood.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>