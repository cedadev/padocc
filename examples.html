<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worked Examples &mdash; Kerchunk Pipeline v1.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pipeline Flags" href="execution.html" />
    <link rel="prev" title="Getting Started" href="start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Kerchunk Pipeline
            <img src="_static/ceda.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pipeline-overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Worked Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-group-of-ukcp-datasets">2. Example Group of UKCP Datasets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialising-the-pipeline">1. Initialising the Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scan-the-datasets">2. Scan the datasets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="execution.html">Pipeline Flags/Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="assess-overview.html">Assessor Tool Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error Codes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pipeline-source.html">Pipeline Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="assess.html">Assessor Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution-source.html">Control Script Source</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kerchunk Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Worked Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="worked-examples">
<h1>Worked Examples<a class="headerlink" href="#worked-examples" title="Permalink to this headline"></a></h1>
<div class="section" id="example-group-of-ukcp-datasets">
<h2>2. Example Group of UKCP Datasets<a class="headerlink" href="#example-group-of-ukcp-datasets" title="Permalink to this headline"></a></h2>
<p>Consider a set of 180 UKCP datasets for which we want to create some Kerchunk files.</p>
<dl class="simple">
<dt>This set of datasets all have the following properties:</dt><dd><ul class="simple">
<li><p>sub_collection: land-rcm</p></li>
<li><p>domain: uk</p></li>
<li><p>resolution: 12km</p></li>
<li><p>scenario: rcp85</p></li>
</ul>
</dd>
</dl>
<p>Which is reflected in the path to the NetCDF files:
<cite>/badc/ukcp18/data/land-rcm/uk/12km/rcp85/</cite></p>
<dl class="simple">
<dt>Below this directory we have directories for __ensemble_member__, __variable_id__, __frequency__ and __version__. For this example we will be using:</dt><dd><ul class="simple">
<li><p>frequency: day</p></li>
<li><p>version: v20190731</p></li>
<li><p>ensemble_member(s) [x12]: 01, 04, 05, 06, 07, 08, 09, 10, 11, 12, 13, 15</p></li>
<li><p>variable_id(s) [x15]: clt, hurs, huss, pr, prsn, psl, rls, rss, sfcWind, snw, tas, tasmax, tasmin, uas, vas</p></li>
</ul>
</dd>
</dl>
<p>Hence there will be 12x15 = 180 Kerchunk datasets at the end of this process.</p>
<div class="section" id="initialising-the-pipeline">
<h3>1. Initialising the Pipeline<a class="headerlink" href="#initialising-the-pipeline" title="Permalink to this headline"></a></h3>
<p>The easiest way to set up the pipeline for running this group is to create a CSV-type file with the details below for each dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">project_code</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">updates</span><span class="o">*</span><span class="p">,</span> <span class="n">removals</span><span class="o">*</span>
</pre></div>
</div>
<p>Updates and Removals can be ignored (left blank) unless a specific metadata change is known and required.
If this is the case, these two can be set as paths to different JSON files which contain the relevant information in the proper format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="c1"># my_updates.json</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;new_id_value&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;new_history_value&gt;</span>
<span class="p">}</span>
<span class="p">{</span> <span class="c1"># my_removals.json</span>
    <span class="s1">&#39;version_no&#39;</span><span class="p">:</span> <span class="kc">True</span> <span class="c1"># Value is irrelevant, only matters that this attribute is present.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>E.g</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UKCP18_land</span><span class="o">-</span><span class="n">rcm_12km_rcp85_01_clt_day_v20190731</span><span class="p">,</span> <span class="o">/</span><span class="n">badc</span><span class="o">/</span><span class="n">ukcp18</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">land</span><span class="o">-</span><span class="n">rcm</span><span class="o">/</span><span class="n">uk</span><span class="o">/</span><span class="mi">12</span><span class="n">km</span><span class="o">/</span><span class="n">rcp85</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="n">clt</span><span class="o">/</span><span class="n">day</span><span class="o">/</span><span class="n">v20190731</span><span class="o">/*</span><span class="p">,</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">updates</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">removals</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>For all 180 datasets in this group. A method of pattern matching and extracting the key information from the path to add to the project code should be used if possible.</p>
<p>To initialise the pipeline with this input CSV file:</p>
<dl class="simple">
<dt>::</dt><dd><p>python group_run.py init UKCP_12km_day -i /path/to/csvfile.csv</p>
</dd>
</dl>
</div>
<div class="section" id="scan-the-datasets">
<h3>2. Scan the datasets<a class="headerlink" href="#scan-the-datasets" title="Permalink to this headline"></a></h3>
<dl class="simple">
<dt>::</dt><dd><p>python group_run.py scan UKCP_12km_day</p>
</dd>
<dt>Parameters that may be necessary at this point:</dt><dd><ul class="simple">
<li><p>time flag: If scan jobs fail for <code class="docutils literal notranslate"><span class="pre">slurmstepd</span></code> errors, use the time flag to change the job time allotment: (<code class="docutils literal notranslate"><span class="pre">`-t</span> <span class="pre">30:00`</span></code> for 30 mins)</p></li>
</ul>
</dd>
</dl>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="start.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="execution.html" class="btn btn-neutral float-right" title="Pipeline Flags" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Daniel Westwood.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>