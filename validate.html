
<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Validation Module &mdash; PADOCC Package v1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=3dd8cc91"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Allocation Module" href="allocation.html" />
    <link rel="prev" title="Compute Module" href="compute.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PADOCC Package
              <img src="_static/padocc_wt.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pipeline-overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="cci_water.html">Example CCI Water Vapour</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution.html">Padocc Flags/Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="assess-overview.html">Assessor Tool Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide.html">Developer Guide - Adding new functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide.html#new-modes-in-assessor">1. New Modes in Assessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide.html#new-processors-for-compute">2. New Processors for Compute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CLI Tool Source:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="assess.html">Assessor Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution-source.html">Control Scripts Source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Source:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="init.html">Initialisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="scan.html">Scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute.html">Compute</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Validate</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.CloudValidator"><code class="docutils literal notranslate"><span class="pre">CloudValidator</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.add_quality"><code class="docutils literal notranslate"><span class="pre">add_quality()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.attempt_timestep"><code class="docutils literal notranslate"><span class="pre">attempt_timestep()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.check_for_nan"><code class="docutils literal notranslate"><span class="pre">check_for_nan()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.compare_data"><code class="docutils literal notranslate"><span class="pre">compare_data()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.find_dimensions"><code class="docutils literal notranslate"><span class="pre">find_dimensions()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.get_concat_dims"><code class="docutils literal notranslate"><span class="pre">get_concat_dims()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.get_netcdf_list"><code class="docutils literal notranslate"><span class="pre">get_netcdf_list()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.get_vslice"><code class="docutils literal notranslate"><span class="pre">get_vslice()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.locate_kerchunk"><code class="docutils literal notranslate"><span class="pre">locate_kerchunk()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.match_timestamp"><code class="docutils literal notranslate"><span class="pre">match_timestamp()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.mem_to_value"><code class="docutils literal notranslate"><span class="pre">mem_to_value()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.open_netcdfs"><code class="docutils literal notranslate"><span class="pre">open_netcdfs()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.run_backtrack"><code class="docutils literal notranslate"><span class="pre">run_backtrack()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.run_successful"><code class="docutils literal notranslate"><span class="pre">run_successful()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.validate_data"><code class="docutils literal notranslate"><span class="pre">validate_data()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.validate_dataset"><code class="docutils literal notranslate"><span class="pre">validate_dataset()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.validate_selection"><code class="docutils literal notranslate"><span class="pre">validate_selection()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.validate_shape_to_tolerance"><code class="docutils literal notranslate"><span class="pre">validate_shape_to_tolerance()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.validate_shapes"><code class="docutils literal notranslate"><span class="pre">validate_shapes()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.validate_timestep"><code class="docutils literal notranslate"><span class="pre">validate_timestep()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.value_to_mem"><code class="docutils literal notranslate"><span class="pre">value_to_mem()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline.validate.verify_connection"><code class="docutils literal notranslate"><span class="pre">verify_connection()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="allocation.html">Allocations</a></li>
<li class="toctree-l1"><a class="reference internal" href="extras.html">Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PADOCC Package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Validation Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/validate.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-pipeline.validate">
<span id="validation-module"></span><h1>Validation Module<a class="headerlink" href="#module-pipeline.validate" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="pipeline.validate.CloudValidator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">CloudValidator</span></span><a class="headerlink" href="#pipeline.validate.CloudValidator" title="Permalink to this definition"></a></dt>
<dd><p>Encapsulate all validation testing into a single class. Instantiate for a specific project,
the object could then contain all project info (from detail-cfg) opened only once. Also a 
copy of the total datasets (from native and cloud sources). Subselections can be passed
between class methods along with a variable index (class variables: variable list, dimension list etc.)</p>
<p>Class logger attribute so this doesn’t need to be passed between functions.
Bypass switch contained here with all switches.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.add_quality">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">add_quality</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">proj_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.add_quality" title="Permalink to this definition"></a></dt>
<dd><p>Add quality_required flag to the detail file for
this project.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.attempt_timestep">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">attempt_timestep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concat_dims</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fullset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.attempt_timestep" title="Permalink to this definition"></a></dt>
<dd><p>Handler for attempting processing on a timestep multiple times.
- Handles error conditions</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.check_for_nan">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">check_for_nan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">box</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.check_for_nan" title="Permalink to this definition"></a></dt>
<dd><p>Special function for assessing if a box selection has non-NaN values within it.
Needs further testing using different data types.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.compare_data">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">compare_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xbox</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kerchunk_box</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#pipeline.validate.compare_data" title="Permalink to this definition"></a></dt>
<dd><p>Compare a NetCDF-derived ND array to a Kerchunk-derived one. This function takes a 
netcdf selection box array of n-dimensions and an equally sized kerchunk_box array and
tests for elementwise equality within selection. If possible, tests max/mean/min calculations 
for the selection to ensure cached values are the same.</p>
<p>Expect TypeErrors later from summations which are bypassed. Other errors will exit the run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vname</strong> – (str) The name of the variable described by this box selection</p></li>
<li><p><strong>xbox</strong> – (obj) The native dataset selection</p></li>
<li><p><strong>kerchunk_box</strong> – (obj) The cloud-format (Kerchunk) dataset selection</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
<li><p><strong>bypass</strong> – (bool) Single value flag for bypassing numeric data errors (in the
case of values which cannot be added).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None but will raise error if data comparison fails.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.find_dimensions">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">find_dimensions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dimlen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">divisions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#pipeline.validate.find_dimensions" title="Permalink to this definition"></a></dt>
<dd><p>Determine index of slice end position given length of dimension and fraction to assess.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dimlen</strong> – (int) The length of the specific dimension</p></li>
<li><p><strong>divisions</strong> – (int) The number of divisions across this dimensions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The size of each division for this dimension, given the number of total divisions.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.get_concat_dims">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">get_concat_dims</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xobjs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proj_dir</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#pipeline.validate.get_concat_dims" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve the sizes of the concatenation dims.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xobjs</strong> – (list) A list of xarray Dataset objects for files which are currently 
being assessed, from which to find the shapes of concat dimensions.</p></li>
<li><p><strong>proj_code</strong> – (str) The project code in string format (DOI)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary of the concatenation dimensions and their array shapes.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.get_netcdf_list">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">get_netcdf_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">proj_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thorough</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#pipeline.validate.get_netcdf_list" title="Permalink to this definition"></a></dt>
<dd><p>Open document containing paths to all NetCDF files, make selections and return a list of files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>proj_dir</strong> – (str) The project code directory path.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
<li><p><strong>thorough</strong> – (bool) If True will select all files for testing, otherwise
standard validation subsetting (0.1% or 3 files) applies.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing a list of all the files as well as a list of indexes to 
specific files for testing. The index list should cover at least 3 files,
with a maximum of 0.1% of the files selected in the case of &gt; 3000 files.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.get_vslice">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">get_vslice</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dimensions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtypes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lengths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">divisions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#pipeline.validate.get_vslice" title="Permalink to this definition"></a></dt>
<dd><p>Assemble dataset slice given the shape of the array and dimensions involved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> – (list) The dimension names for an array currently being assessed.</p></li>
<li><p><strong>dtypes</strong> – (list) A list of the datatypes corresponding to each dimension for an array.</p></li>
<li><p><strong>lengths</strong> – (list) The lengths of each dimension for an array.</p></li>
<li><p><strong>divisions</strong> – (list) The number of divisions for each of the dimensions for an array.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Slice for this particular division set. Special cases for datetime-like objects.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.locate_kerchunk">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">locate_kerchunk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_str</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attempt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remote_protocol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'https'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dataset</span></span></span><a class="headerlink" href="#pipeline.validate.locate_kerchunk" title="Permalink to this definition"></a></dt>
<dd><p>Gets the name of the latest kerchunk file for this project code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – (obj) Set of command line arguments supplied by argparse.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
<li><p><strong>get_str</strong> – (bool) If True will return the string filename for the selected
Kerchunk file, otherwise the Kerchunk file will be opened as an 
xarray Virtual Dataset.</p></li>
<li><p><strong>remote_protocol</strong> – (str) Default ‘https’ for accessing files post-compute
since these have been reconfigured for remote testing.
Override with ‘file’ for Kerchunk files with a local 
reference.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Xarray Virtual Dataset from a Kerchunk file, or the string filename
of the Kerchunk file if get_str is enabled.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.match_timestamp">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">match_timestamp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xobject</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kobject</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="headerlink" href="#pipeline.validate.match_timestamp" title="Permalink to this definition"></a></dt>
<dd><p>Match timestamp of xarray object to kerchunk object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xobject</strong> – (obj) An xarray dataset representing the original files opened natively.</p></li>
<li><p><strong>kobject</strong> – (obj) An xarray dataset representing the Kerchunk file constructed by the pipeline.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing subselections of both xarray datasets such that both now have
matching timestamps.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.mem_to_value">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">mem_to_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mem</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#pipeline.validate.mem_to_value" title="Permalink to this definition"></a></dt>
<dd><p>Convert a memory value i.e 2G into a value</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Int value of e.g. ‘2G’ in bytes.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.open_netcdfs">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">open_netcdfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thorough</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concat_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'time'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#pipeline.validate.open_netcdfs" title="Permalink to this definition"></a></dt>
<dd><p>Returns a single xarray object with one timestep:</p>
<ol class="arabic simple">
<li><p>Select a single file and a single timestep from that file</p></li>
<li><p>Verify that a single timestep can be selected (Yes: return this xarray object, No: select all files and select a single timestep from that)</p></li>
<li><p>In all cases, returns a list of xarray objects.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – (obj) Set of command line arguments supplied by argparse.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
<li><p><strong>thorough</strong> – (bool) If True will concatenate all selected Datasets to a single
combined dataset, rather than a list of individual separate objects.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of the xarray datasets (or a single concatenated dataset), along with a list
of indexes to use for selecting a subset of those files, plus a list of filepaths to
the original files.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.run_backtrack">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">run_backtrack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">workdir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupID</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proj_code</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quality</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.run_backtrack" title="Permalink to this definition"></a></dt>
<dd><p>Backtrack progress on all output files. If quality is specified as well, files are removed rather than backtracked</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.run_successful">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">run_successful</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.run_successful" title="Permalink to this definition"></a></dt>
<dd><p>Move kerchunk-1a.json file to complete directory with proper name</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.validate_data">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">validate_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xv:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step:</span> <span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass=&lt;pipeline.utils.BypassSwitch</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth_default=128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfiles=2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.validate_data" title="Permalink to this definition"></a></dt>
<dd><p>Run growing selection test for specified variable from xarray and kerchunk datasets</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.validate_dataset">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">validate_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.validate_dataset" title="Permalink to this definition"></a></dt>
<dd><p>Perform validation steps for specific dataset defined here, sets up a local dask cluster to limit
memory usage, retrieves the set of xarray objects and the kerchunk dataset, then runs validation
on each of the selected indexes (subset of total number of objects).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – (obj) Set of command line arguments supplied by argparse.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages. Will create a new 
logger object if not given one.</p></li>
<li><p><strong>fh</strong> – (str) Path to file for logger I/O when defining new logger.</p></li>
<li><p><strong>logid</strong> – (str) If creating a new logger, will need an id to distinguish this logger
from other single processes (typically n of N total processes.)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.validate_selection">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">validate_selection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xvariable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kvariable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vname:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">divs:</span> <span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">currentdiv:</span> <span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass=&lt;pipeline.utils.BypassSwitch</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.validate_selection" title="Permalink to this definition"></a></dt>
<dd><dl class="simple">
<dt>Validate this data selection in xvariable/kvariable objects</dt><dd><ul class="simple">
<li><p>Recursive function tests a growing selection of data until one is found with real data</p></li>
<li><p>Repeats with exponentially increasing box size (divisions of all data dimensions)</p></li>
<li><p>Will halt at 1 division which equates to testing all data</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Number of attempts to connect to all required data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.validate_shape_to_tolerance">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">validate_shape_to_tolerance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nfiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xv</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dims</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xshape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kshape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proj_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#pipeline.validate.validate_shape_to_tolerance" title="Permalink to this definition"></a></dt>
<dd><p>Special case function for validating a shaped array to some tolerance. This is an alternative to
opening N files, only works if each file has roughly the same total shape. Tolerance is based on 
the number of files supplied, more files means the tolerance is lower?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nfiles</strong> – (int) The number of native files across the whole dataset.</p></li>
<li><p><strong>xv</strong> – (str) The name of the variable within the dataset.</p></li>
<li><p><strong>dims</strong> – (tuple) A list of the names of the dimensions in this dataset.</p></li>
<li><p><strong>xshape</strong> – (tuple) The shape of the array from the original native files.</p></li>
<li><p><strong>kshape</strong> – (tuple) The shape of the array from the cloud formatted dataset.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
<li><p><strong>proj_dir</strong> – (str) The project code directory path.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.validate_shapes">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">validate_shapes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xv</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bypass_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proj_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concat_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#pipeline.validate.validate_shapes" title="Permalink to this definition"></a></dt>
<dd><p>Ensure shapes are equivalent across Kerchunk/NetCDF per variable. Must account for the number 
of files opened vs how many files in total.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xobj</strong> – (obj) The native dataset selection.</p></li>
<li><p><strong>kobj</strong> – (obj) The cloud-format (Kerchunk) dataset selection</p></li>
<li><p><strong>nfiles</strong> – (int) The number of native files for this whole dataset.</p></li>
<li><p><strong>xv</strong> – (str) The name of the variable within the dataset.</p></li>
<li><p><strong>logger</strong> – (obj) Logging object for info/debug/error messages.</p></li>
<li><p><strong>bypass_shape</strong> – (bool) Switch for bypassing shape errors - diverts to tolerance testing as a backup.</p></li>
<li><p><strong>proj_dir</strong> – (str) The project code directory path.</p></li>
<li><p><strong>concat_dims</strong> – (dict) Dictionary of concatenation dimensions with their appropriate 
sizes by index. (e.g {‘time’:100})</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None but will raise error if shape validation fails.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.validate_timestep">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">validate_timestep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">concat_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.validate_timestep" title="Permalink to this definition"></a></dt>
<dd><p>Run all tests for a single file which may or may not equate to 1 timestep</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.value_to_mem">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">value_to_mem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#pipeline.validate.value_to_mem" title="Permalink to this definition"></a></dt>
<dd><p>Convert a number of bytes i.e 1000000000 into a string</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>String value of the above (1000000000 -&gt; 1M)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.validate.verify_connection">
<span class="sig-prename descclassname"><span class="pre">pipeline.validate.</span></span><span class="sig-name descname"><span class="pre">verify_connection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.validate.verify_connection" title="Permalink to this definition"></a></dt>
<dd><p>Verify connection to the CEDA archive by opening a test file in Kerchunk and
comparing to a known value.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="compute.html" class="btn btn-neutral float-left" title="Compute Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="allocation.html" class="btn btn-neutral float-right" title="Allocation Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Centre of Environmental Data Analysis Developers,Scientific and Technical Facilities Council (STFC),UK Research and Innovation (UKRI). BSD 2-Clause License. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #e92603;
    }

    .caption-text, .header h1 {
        color: #ef4d5a
    }

    .note {
        background: #BEEF9E
    }
    .admonition-title {
        background: #335145
    }

    .wy-nav-side {
        background: #001711;
    }

  </style>


</body>
</html>